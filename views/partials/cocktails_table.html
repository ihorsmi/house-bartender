{{define "cocktails_table.html"}}
{{ $u := $.User }}
{{with .Page}}
  {{if .Cocktails}}
    {{range .Cocktails}}
      <article class="card card--compact">
        <div class="cocktailRow">
          <div class="grow">
            <div class="row row--gap row--wrap">
              <strong>{{.Name}}</strong>

              {{if .ComputedAvail}}
                <span class="badge badge--ok">Available</span>
              {{else}}
                <span class="badge">Unavailable</span>
              {{end}}

              {{if .IsEnabled}}
                <span class="badge badge--ok">Enabled</span>
              {{else}}
                <span class="badge">Disabled</span>
              {{end}}
            </div>

            {{if .Description}}<p class="muted">{{.Description}}</p>{{end}}

            <div class="row row--gap row--wrap muted">
              {{if .Difficulty}}<span>Difficulty: {{.Difficulty}}</span>{{end}}
              {{if gt .PrepTimeMinutes 0}}<span>Prep: {{.PrepTimeMinutes}}m</span>{{end}}
            </div>

            {{if .Tags}}
              <div class="row row--gap row--wrap">
                {{range (splitCSV .Tags)}}
                  <span class="tag">{{.}}</span>
                {{end}}
              </div>
            {{end}}
          </div>

          <div class="cocktailActions">
            {{if and $u (or (eq $u.Role "BARTENDER") (eq $u.Role "ADMIN"))}}
              <form method="post"
                    action="/bartender/cocktails/{{.ID}}/toggle"
                    data-hx-post="/bartender/cocktails/{{.ID}}/toggle"
                    data-hx-target="#cocktailsTable"
                    data-hx-swap="innerHTML">
                <input type="hidden" name="is_enabled" value="{{if .IsEnabled}}0{{else}}1{{end}}">
                <button class="btn btn--small" type="submit">{{if .IsEnabled}}Disable{{else}}Enable{{end}}</button>
              </form>

              <a class="btn btn--small btn--ghost" href="/bartender/cocktails/{{.ID}}/edit">Edit</a>

              <form method="post"
                    action="/bartender/cocktails/{{.ID}}/delete"
                    data-hx-post="/bartender/cocktails/{{.ID}}/delete"
                    data-hx-target="#cocktailsTable"
                    data-hx-swap="innerHTML"
                    onsubmit="return confirm('Delete cocktail?');">
                <button class="btn btn--small btn--danger" type="submit">Delete</button>
              </form>

              <a class="btn btn--small" href="/cocktails/{{.ID}}">View recipe</a>
            {{else}}
              <a class="btn btn--small" href="/cocktails/{{.ID}}">Details</a>
            {{end}}
          </div>
        </div>
      </article>
    {{end}}
  {{else}}
    <p class="muted">No cocktails found.</p>
  {{end}}
{{else}}
  <p class="muted">No cocktails found.</p>
{{end}}
{{end}}
